<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidian | Construction Technology Solutions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-dark: #4B2E83;
            --primary: #6A4C9D;
            --primary-light: #9D8DCB;
            --primary-very-light: #F0EBF8;
            --accent: #FFA630;
            --neutral: #5D5D5D;
            --highlight: #FFD166;
            --white: #FFFFFF;
            --text: #2D3748;
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);

            --heading-font: 'Playfair Display', serif;
            --subheading-font: 'Manrope', sans-serif;
            --heading-size: 2.8rem;
            --subheading-size: 1.8rem;
            --body-size: 1.15rem;
            --small-text: 1rem;

            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            --space-xxl: 4rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--subheading-font);
            color: var(--text);
            background-color: var(--white);
            line-height: 1.6;
            font-size: var(--body-size);
        }

        #solutions-section {
            background: white;
            padding: var(--space-xxl) var(--space-md);
            position: relative;
            z-index: 2;
        }

        .section-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }

        .section-header h2 {
            font-family: var(--heading-font);
            font-size: var(--heading-size);
            color: var(--primary-dark);
            margin-bottom: var(--space-sm);
            line-height: 1.3;
            font-weight: 700;
        }

        .section-header h2::after {
            content: '';
            display: block;
            width: 100px;
            height: 4px;
            background: var(--primary);
            margin: var(--space-sm) auto 0;
            border-radius: 2px;
        }

        .section-header p {
            font-family: var(--subheading-font);
            color: var(--neutral);
            max-width: 700px;
            margin: 0 auto;
            font-size: var(--subheading-size);
            font-weight: 500;
            line-height: 1.5;
        }

        .solutions-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .solution-section {
            margin-bottom: var(--space-xxl);
        }

        .solution-section-title {
            font-family: var(--heading-font);
            font-size: var(--subheading-size);
            color: var(--primary-dark);
            margin-bottom: var(--space-lg);
            position: relative;
            padding-left: var(--space-sm);
            line-height: 1.3;
        }

        .solution-section-title:before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        .solution-section-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: var(--primary);
            margin-top: var(--space-sm);
        }

        .solution-cards-container {
            display: flex;
            gap: var(--space-lg);
            justify-content: center;
            flex-wrap: wrap;
        }

        .solution-cards-container.single-card {
            justify-content: center;
        }

        .solution-card {
            background: white;
            border-radius: 12px;
            padding: var(--space-lg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            border-top: 3px solid var(--primary);
            display: flex;
            flex-direction: column;
            width: 500px;
            min-height: 400px;
        }

        .solution-cards-container.single-card .solution-card {
            width: 500px;
            min-height: 400px;
        }

        .solution-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .solution-card-content {
            flex: 1;
            margin-bottom: var(--space-md);
        }

        .solution-card p {
            font-family: var(--subheading-font);
            color: var(--neutral);
            font-size: var(--body-size);
            margin-bottom: var(--space-md);
            line-height: 1.6;
        }

        .solution-video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .solution-video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .coming-soon {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 8px;
            padding: var(--space-lg);
            text-align: center;
            font-style: italic;
            color: var(--neutral);
            height: 100%;
            font-size: var(--body-size);
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-container {
            text-align: center;
            padding: 40px;
        }

        .error-message {
            text-align: center;
            color: #ff4444;
            font-size: 1.2rem;
            padding: 20px;
            background-color: #fff0f0;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 600px;
        }

        .debug-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }

        .full-width-purple {
            width: 100vw;
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
            background-color: var(--primary-very-light);
        }

        .other-solutions-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-xxl) var(--space-md);
        }

        .other-solutions-title {
            font-family: var(--heading-font);
            font-size: var(--heading-size);
            color: var(--primary-dark);
            margin-bottom: var(--space-xl);
            text-align: center;
            line-height: 1.3;
            font-weight: 700;
        }

        .other-solutions-title::after {
            content: '';
            display: block;
            width: 100px;
            height: 4px;
            background: var(--primary);
            margin: var(--space-sm) auto 0;
            border-radius: 2px;
        }

        .checkerboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            margin-bottom: var(--space-xl);
            background-color: #ddd;
        }

        .solution-box {
            padding: var(--space-lg);
            min-height: 200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .solution-box.purple {
            background-color: var(--primary);
            color: white;
        }

        .solution-box.white {
            background-color: white;
            color: var(--text);
        }

        .solution-box h4 {
            font-family: var(--heading-font);
            font-size: 1.5rem;
            margin-bottom: var(--space-sm);
            position: relative;
            z-index: 2;
            line-height: 1.3;
        }

        .solution-box p {
            font-family: var(--subheading-font);
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
            font-size: var(--body-size);
            line-height: 1.6;
        }

        .solution-box:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .solution-box:hover p {
            opacity: 1;
            max-height: 200px;
        }

        .solution-box.purple:hover {
            background-color: var(--primary-dark);
        }

        .solution-box.white:hover {
            background-color: #f9f9f9;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--primary);
            color: var(--white);
            text-decoration: none;
            border-radius: 8px;
            font-family: var(--subheading-font);
            font-size: var(--small-text);
            font-weight: 600;
            transition: var(--transition);
            margin-bottom: var(--space-lg);
        }

        .back-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .back-button i {
            font-size: var(--small-text);
        }

        @media (max-width: 1024px) {
            :root {
                --heading-size: 2.4rem;
                --subheading-size: 1.6rem;
                --body-size: 1.1rem;
            }
            
            .solution-cards-container {
                flex-direction: column;
                align-items: center;
            }
            
            .solution-card {
                width: 500px;
                min-height: 400px;
            }
            
            .solution-cards-container.single-card .solution-card {
                width: 500px;
                min-height: 400px;
            }
        }

        @media (max-width: 768px) {
            :root {
                --heading-size: 2rem;
                --subheading-size: 1.4rem;
                --body-size: 1.05rem;
            }

            #solutions-section {
                padding: var(--space-xl) var(--space-md);
            }

            .solution-section {
                margin-bottom: var(--space-xl);
            }

            .checkerboard-grid {
                grid-template-columns: 1fr;
            }

            .solution-box {
                min-height: 200px;
                width: 100%;
            }
            
            .section-header h2::after,
            .other-solutions-title::after {
                width: 80px;
                height: 3px;
            }
        }

        @media (max-width: 480px) {
            :root {
                --heading-size: 1.8rem;
                --subheading-size: 1.2rem;
                --body-size: 1rem;
            }
            
            .solution-card {
                padding: var(--space-md);
                width: 100%;
                min-height: 350px;
            }
            
            .section-header h2::after,
            .other-solutions-title::after {
                width: 70px;
            }
        }
    </style>
</head>
<body>
    <section id="solutions-section">
        <a href="home.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>
        <div class="section-header">
            <h2>Solutions</h2>
            <p>Innovative Tools Designed To Streamline Your Engineering Workflow and Enhance Productivity</p>
        </div>

        <div class="solutions-container" id="solutions-dynamic-container">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <p>Loading solutions...</p>
            </div>
        </div>
    </section>

    <div class="full-width-purple">
        <section class="other-solutions-section">
            <h2 class="other-solutions-title">Other Solutions</h2>
            <div class="checkerboard-grid">
                <div class="solution-box purple">
                    <h4>RFP Generation</h4>
                    <p>Leverage past data to win more projects at a fraction of the time</p>
                </div>
                <div class="solution-box white">
                    <h4>Data Organization</h4>
                    <p>Ensure folder structure and documents are laid to enable machine learning</p>
                </div>
                <div class="solution-box purple">
                    <h4>Contract Understanding</h4>
                    <p>Quickly identify crucial aspects of contracts to ensure nothing is missed</p>
                </div>
                <div class="solution-box white">
                    <h4>Permit Completion</h4>
                    <p>Complete permit approval at a fraction of the time to reduce project delays</p>
                </div>
                <div class="solution-box purple">
                    <h4>Project Database</h4>
                    <p>Retrieve information from drawings, detailing, and design to leverage past projects</p>
                </div>
                <div class="solution-box white">
                    <h4>Takeoff Estimates</h4>
                    <p>Quickly determine building costs for materials, expected timelines, etc</p>
                </div>
            </div>
        </section>
    </div>

    <div class="debug-info" id="debug-info"></div>

    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://yccunwxamevfxiwmrpiu.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InljY3Vud3hhbWV2Znhpd21ycGl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1OTE0NjMsImV4cCI6MjA2MzE2NzQ2M30.NGoQBYT6nvxTdz1g5JJ4ZNgvo8zwjgEuyvMfvQmPSNw';
        
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        
        const debugInfo = document.getElementById('debug-info');

        // Function to fetch and display solutions
        async function loadSolutions() {
            try {
                debugInfo.textContent = "Connecting to Supabase...";
                
                // Fetch solutions from Supabase
                const { data: solutions, error, status } = await supabaseClient
                    .from('solutions')
                    .select('*')
                    .order('created_at', { ascending: false });

                debugInfo.textContent = `Supabase response: ${status}`;
                
                if (error) {
                    debugInfo.textContent += ` | Error: ${error.message}`;
                    throw error;
                }
                
                if (!solutions || solutions.length === 0) {
                    debugInfo.textContent += " | No solutions found in database";
                } else {
                    debugInfo.textContent += ` | Found ${solutions.length} solutions`;
                    // Log URLs for debugging
                    solutions.forEach((solution, index) => {
                        console.log(`Solution ${index + 1} (${solution.title}):`);
                        console.log(`youtube_url1: ${solution.youtube_url1}`);
                        console.log(`youtube_url2: ${solution.youtube_url2 || 'N/A'}`);
                    });
                }
                
                renderSolutions(solutions);
            } catch (error) {
                console.error('Error loading solutions:', error);
                document.getElementById('solutions-dynamic-container').innerHTML = 
                    `<div class="error-message">
                        <h3>Failed to load solutions</h3>
                        <p>${error.message || 'Please try again later'}</p>
                        <p>Check browser console for details</p>
                    </div>`;
            }
        }

        // Function to render solutions
        function renderSolutions(solutions) {
            const container = document.getElementById('solutions-dynamic-container');
            
            if (!solutions || solutions.length === 0) {
                container.innerHTML = `
                    <div class="error-message">
                        <h3>No Solutions Found</h3>
                        <p>Please add solutions to your Supabase database</p>
                        <p>Table name: <code>solutions</code></p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            solutions.forEach(solution => {
                const hasSecondCard = solution.description2 || solution.youtube_url2;
                
                html += `
                    <div class="solution-section">
                        <h3 class="solution-section-title">${solution.title}</h3>
                        <div class="solution-cards-container ${hasSecondCard ? '' : 'single-card'}">
                            <div class="solution-card">
                                <div class="solution-card-content">
                                    <p>${solution.description1}</p>
                                </div>
                                <div class="solution-video-container">
                `;
                
                // FIXED: Use the new robust URL parser
                let embedUrl1 = getEmbedUrl(solution.youtube_url1, solution.title, 'youtube_url1');
                
                if (embedUrl1) {
                    html += `
                        <iframe src="${embedUrl1}" 
                                title="${solution.title} video" 
                                allowfullscreen>
                        </iframe>
                    `;
                } else {
                    html += `
                        <div class="coming-soon">
                            Video unavailable. Please check the YouTube URL or embedding settings.
                        </div>
                    `;
                }
                
                html += `
                                </div>
                            </div>
                `;
                
                // Second card if data exists
                if (hasSecondCard) {
                    html += `
                            <div class="solution-card">
                                <div class="solution-card-content">
                                    <p>${solution.description2 || ''}</p>
                                </div>
                                <div class="solution-video-container">
                    `;
                    
                    // FIXED: Use the new robust URL parser
                    const embedUrl2 = getEmbedUrl(solution.youtube_url2, solution.title, 'youtube_url2');
                    if (embedUrl2) {
                        html += `
                            <iframe src="${embedUrl2}" 
                                    title="${solution.title} video" 
                                    allowfullscreen>
                            </iframe>
                        `;
                    } else {
                        html += `
                            <div class="coming-soon">
                                Video unavailable. Please check the YouTube URL or embedding settings.
                            </div>
                        `;
                    }
                    
                    html += `
                                </div>
                            </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // FIXED: New robust function to handle all YouTube URL formats
        function getEmbedUrl(url, solutionTitle, urlField) {
            if (!url) {
                console.warn(`No URL provided for ${solutionTitle} (${urlField})`);
                return '';
            }
            
            const trimmedUrl = url.trim();
            console.log(`Processing ${urlField} for ${solutionTitle}: ${trimmedUrl}`);
            
            // Handle YouTube URLs with improved regex
            if (trimmedUrl.includes('youtube.com') || trimmedUrl.includes('youtu.be')) {
                // This regex handles all YouTube URL formats:
                //   - Standard watch URLs: https://www.youtube.com/watch?v=VIDEO_ID
                //   - Short URLs: https://youtu.be/VIDEO_ID
                //   - Embed URLs: https://www.youtube.com/embed/VIDEO_ID
                //   - Live URLs: https://www.youtube.com/live/VIDEO_ID
                const regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=|live\/)([^#&?]{11,})/;
                const match = trimmedUrl.match(regExp);
                const videoId = (match && match[2]) ? match[2].substring(0, 11) : null;
                
                if (videoId) {
                    const embedUrl = `https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1`;
                    console.log(`Generated embed URL for ${solutionTitle} (${urlField}): ${embedUrl}`);
                    return embedUrl;
                } else {
                    console.error(`Invalid YouTube video ID for ${solutionTitle} (${urlField}): ${trimmedUrl}`);
                    return '';
                }
            }
            
            // Handle Vimeo URLs
            if (trimmedUrl.includes('vimeo.com')) {
                const regExp = /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/;
                const match = trimmedUrl.match(regExp);
                const videoId = match ? match[5] : null;
                
                if (videoId) {
                    const embedUrl = `https://player.vimeo.com/video/${videoId}?title=0&byline=0&portrait=0`;
                    console.log(`Generated embed URL for ${solutionTitle} (${urlField}): ${embedUrl}`);
                    return embedUrl;
                } else {
                    console.error(`Invalid Vimeo video ID for ${solutionTitle} (${urlField}): ${trimmedUrl}`);
                    return '';
                }
            }
            
            console.warn(`Unrecognized video URL format for ${solutionTitle} (${urlField}): ${trimmedUrl}`);
            return '';
        }

        // Load solutions when page loads
        document.addEventListener('DOMContentLoaded', loadSolutions);
    </script>
</body>
</html>